version: "3.8"

services:
  # Training service
  trainer:
    build: .
    container_name: hospital-rl-trainer
    volumes:
      - ./models:/app/models
      - ./tb_logs:/app/tb_logs
    environment:
      - TIMESTEPS=20000
      - LEARNING_RATE=1e-3
      - BUFFER_SIZE=50000
      - BATCH_SIZE=32
    command: python train/train.py
    networks:
      - rl-network

  # Inference API service
  api:
    build: .
    container_name: hospital-rl-api
    volumes:
      - ./models:/app/models
    ports:
      - "8000:8000"
    environment:
      - MODEL_PATH=models/dqn_inventory
    command: uvicorn inference.api:app --host 0.0.0.0 --port 8000 --reload
    depends_on:
      - trainer
    networks:
      - rl-network
    restart: unless-stopped

  # TensorBoard for monitoring
  tensorboard:
    image: tensorflow/tensorflow:latest
    container_name: hospital-rl-tensorboard
    volumes:
      - ./tb_logs:/logs
    ports:
      - "6006:6006"
    command: tensorboard --logdir=/logs --host=0.0.0.0 --port=6006
    networks:
      - rl-network
    restart: unless-stopped

networks:
  rl-network:
    driver: bridge

volumes:
  models:
  tb_logs:
